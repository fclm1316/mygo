package service

import (
	"allinone/dao"
	// "allinone/model"
	"allinone/po"
	"allinone/tool"

	// "encoding/json"
	"fmt"
	// "path"
)

type FileInfo struct {
}

func (fi *FileInfo) GetFileMd5() (int64, error) {
	var err error
	var mimi []po.FileListList
	stdao := dao.FileListDao{4, tool.DbEngine}
	if mimi, err = stdao.SelectByFileInfo(); err != nil {
		return 1, err
	}

	for _, value := range mimi {
		// var fileinfo model.File_info

		cmd := fmt.Sprintln("md5sum %s/%s", value.Filepath, value.Filename)
		sshc := tool.NewSSHClient(value.Ipaddr, value.User, value.Passwd, cmd)
		if err := sshc.Run(); err != nil {
			fmt.Println(err.Error())
			return 0, err
		}
		fmt.Println(sshc.Result)
		// absfilepath := path.Join(value.Filepath, value.Filename)
		// fileinfo.Filemd5 =
		// fileinfo.Filemodtime =
		// fileinfo.Filesize =

	}

	// data, err := json.Unmarshal(&mimi)
	// if err != nil {
	// 	return 0, err
	// }
	// fmt.Println(string(data))
	// for key, value := range data[0] {
	// 	fmt.Println(key, string(value))
	// }
	return 1, nil
}
