package controller

import (
	"allinone/param"
	"allinone/service"
	"allinone/tool"

	"fmt"

	"github.com/gin-gonic/gin"
)

type SysInfoController struct {
}

func (sysinfo *SysInfoController) Router(engine *gin.Engine) {
	engine.GET("/sysinfo", sysinfo.GetInfo)
	engine.POST("/sysinfo", sysinfo.AddInfo)
	engine.PUT("/sysinfo", sysinfo.UpdateInfo)

}

func (sysinfo *SysInfoController) GetInfo(context *gin.Context) {

	var GetSysInfoParam param.SysInfoGetParam
	GetSysInfoParam.Id = context.DefaultQuery("id", "none")
	GetSysInfoParam.EnvId = context.DefaultQuery("envid", "none")
	GetSysInfoParam.Ip = context.DefaultQuery("ipaddr", "none")
	GetSysInfoParam.NameId = context.DefaultQuery("nameid", "none")
	GetSysInfoParam.PS = tool.NewPageOffset()
	GetSysInfoParam.PS.Convert(context.DefaultQuery("page", "none"), context.DefaultQuery("offset", "none"))

	ts := service.SysInfo{}
	result, err := ts.GetInfo(&GetSysInfoParam)
	if err != nil {
		tool.Failed(context, err.Error())
		return
	}
	respose := tool.SuccessListStruct{}
	respose.SuccessList(context, result)

}
func (sysinfo *SysInfoController) AddInfo(context *gin.Context) {

	var AddSysInfoParam param.SysInfoAddParam
	if err := context.ShouldBindJSON(&AddSysInfoParam); err != nil {
		tool.Failed(context, err.Error())
		fmt.Println(AddSysInfoParam)
		return
	}

	ts := service.SysInfo{}
	result, err := ts.AddInfo(&AddSysInfoParam)
	if err != nil {
		tool.Failed(context, err.Error())
		return
	}
	respose := tool.SuccessListStruct{}
	respose.SuccessList(context, result)
}
